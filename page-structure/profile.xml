<?xml version="1.0" encoding="UTF-8"?>
<!-- 
  {IoTBay User Profile Pages Structure}
  {This XML describes Profiles.jsp and updateProfile.jsp - user profile management pages}
  {Purpose: Document profile viewing and editing page structure}
-->
<pages name="profile" type="user-profile">
  
  <!-- {Profile View Page} -->
  <page name="profile-view" jsp-file="Profiles.jsp">
    
    <metadata>
      <title>My Profile - IoTBay</title>
      <description>View and manage your IoTBay account profile</description>
      <route>/profile</route>
      <template>t:base</template>
      <authentication>required</authentication>
    </metadata>

    <structure>
      
      <!-- {Page Header} -->
      <section name="page-header">
        <breadcrumb>
          <item name="Home" route="/"/>
          <item name="My Account" route="/profile"/>
          <item name="Profile" active="true"/>
        </breadcrumb>
        <title>My Profile</title>
      </section>

      <!-- {Profile Content - Two Column Layout} -->
      <section name="profile-content" type="two-column" class="l-two-column l-spacing-lg">
        <layout-structure>
          <design>Two-column layout: Profile info (left) + Account settings sidebar (right)</design>
          <desktop>
            <left-column width="calc(100% - 320px)" min-width="600px" padding="0 24px 0 0"/>
            <right-column width="320px" padding="0 0 0 24px" position="sticky" top="24px"/>
          </desktop>
          <tablet>
            <layout>Stacked columns (1 column)</layout>
            <spacing>24px gap between sections</spacing>
          </tablet>
          <mobile>
            <layout>Single column, full width</layout>
            <spacing>16px gap</spacing>
          </mobile>
        </layout-structure>
        
        <!-- {Left Column: Profile Information} -->
        <column name="profile-info" class="content-zone">
          <component-size>
            <width>Desktop: calc(100% - 320px), Mobile: 100%</width>
            <padding>0</padding>
          </component-size>
          
          <!-- {Personal Information Card} -->
          <card name="personal-info" class="c-card c-card--bordered l-spacing-md">
            <component-size>
              <width>100%</width>
              <padding>24px</padding>
              <background>#FFFFFF</background>
              <border-radius>8px</border-radius>
              <box-shadow>0 1px 3px rgba(0,0,0,0.1)</box-shadow>
              <margin-bottom:>24px</margin-bottom:>
            </component-size>
            <card-header class="flex justify-between items-center l-spacing-sm">
              <component-size>
                <padding-bottom:>16px</padding-bottom:>
                <border-bottom:>1px solid var(--neutral-200)</border-bottom:>
                <margin-bottom:>16px</margin-bottom:>
              </component-size>
              <title class="text-display-s">Personal Information</title>
              <action>
                <button component="atoms/button" type="secondary" route="/updateProfile" text="Edit">
                  <component-size>
                    <button-height>36px</button-height>
                    <padding:>0 16px</padding:>
                  </component-size>
                </button>
                <!-- {Link to profile edit page} -->
              </action>
            </card-header>
            
            <card-content>
              <info-row class="flex justify-between l-spacing-xs">
                <component-size>
                  <padding:>12px 0</padding:>
                  <border-bottom:>1px solid var(--neutral-100)</border-bottom:>
                </component-size>
                <label class="text-body-m font-medium">Name</label>
                <value class="text-body-m">{user.firstName} {user.lastName}</value>
              </info-row>
              
              <info-row>
                <label>Email</label>
                <value>{user.email}</value>
                <badge condition="emailVerified" type="verified" text="Verified"/>
                <!-- {Show verified badge if email is verified} -->
              </info-row>
              
              <info-row>
                <label>Phone</label>
                <value>{user.phone || "Not provided"}</value>
              </info-row>
              
              <info-row>
                <label>Member Since</label>
                <value>{user.createdAt}</value>
                <!-- {Account creation date} -->
              </info-row>
            </card-content>
          </card>

          <!-- {Shipping Addresses Card} -->
          <card name="shipping-addresses" class="c-card c-card--bordered l-spacing-md">
            <component-size>
              <width>100%</width>
              <padding>24px</padding>
              <background>#FFFFFF</background>
              <border-radius>8px</border-radius>
              <margin-bottom:>24px</margin-bottom:>
            </component-size>
            <card-header class="flex justify-between items-center l-spacing-sm">
              <component-size>
                <padding-bottom:>16px</padding-bottom:>
                <border-bottom:>1px solid var(--neutral-200)</border-bottom:>
                <margin-bottom:>16px</margin-bottom:>
              </component-size>
              <title class="text-display-s">Shipping Addresses</title>
              <action>
                <button component="atoms/button" type="primary" action="addAddress" text="Add Address">
                  <component-size>
                    <button-height>36px</button-height>
                    <padding:>0 16px</padding:>
                  </component-size>
                </button>
              </action>
            </card-header>
            
            <card-content>
              <addresses class="space-y-4">
                <component-size>
                  <gap:>16px between address items</gap:>
                </component-size>
                <address-item class="c-card c-card--bordered">
                  <component-size>
                    <width>100%</width>
                    <padding:>20px</padding:>
                    <background:>#F9FAFB</background:>
                    <border-radius:>8px</border-radius:>
                  </component-size>
                  <!-- {List of saved shipping addresses} -->
                  <address>
                    <component-size>
                      <gap:>8px between address lines</gap:>
                      <margin-bottom:>12px</margin-bottom:>
                    </component-size>
                    <name class="text-body-m font-semibold">{address.fullName}</name>
                    <street class="text-body-s">{address.streetAddress}</street>
                    <city-state-zip class="text-body-s">{address.city}, {address.state} {address.zipCode}</city-state-zip>
                    <country class="text-body-s">{address.country}</country>
                  </address>
                  <actions class="flex gap-2">
                    <component-size>
                      <button-height:>32px</button-height:>
                      <gap:>8px between buttons</gap:>
                    </component-size>
                    <button component="atoms/button" type="secondary" size="sm" action="editAddress" text="Edit"/>
                    <button component="atoms/button" type="secondary" size="sm" action="deleteAddress" text="Delete"/>
                    <button component="atoms/button" type="primary" size="sm" condition="!isDefault" action="setDefault" text="Set as Default"/>
                  </actions>
                  <badge component="atoms/badge" condition="isDefault" type="default" text="Default">
                    <component-size>
                      <badge-size:>Auto width, height: 24px</badge-size:>
                      <position:>absolute top-4 right-4</position:>
                    </component-size>
                  </badge>
                </address-item>
              </addresses>
              
              <empty-state condition="noAddresses">
                <message>No saved addresses</message>
                <action>
                  <button type="primary" action="addAddress" text="Add Your First Address"/>
                </action>
              </empty-state>
            </card-content>
          </card>

          <!-- {Account Settings Card} -->
          <card name="account-settings">
            <card-header>
              <title>Account Settings</title>
            </card-header>
            
            <card-content>
              <settings-list>
                <setting-item>
                  <label>Email Notifications</label>
                  <toggle name="emailNotifications" value="{user.emailNotifications}"/>
                  <!-- {Toggle for email notification preferences} -->
                </setting-item>
                
                <setting-item>
                  <label>Newsletter Subscription</label>
                  <toggle name="newsletter" value="{user.newsletter}"/>
                </setting-item>
                
                <setting-item>
                  <label>Two-Factor Authentication</label>
                  <status condition="2faEnabled" text="Enabled"/>
                  <action condition="!2faEnabled">
                    <button type="secondary" action="enable2FA" text="Enable"/>
                  </action>
                </setting-item>
              </settings-list>
            </card-content>
          </card>

        </column>

        <!-- {Right Column: Quick Actions & Stats} -->
        <column name="sidebar" class="summary-section l-sticky">
          <component-size>
            <width>Desktop: 320px (fixed), Mobile: 100%</width>
            <padding>0</padding>
            <position>sticky</position>
            <top-offset>24px</top-offset>
          </component-size>
          
          <!-- {Account Summary Card} -->
          <card name="account-summary" class="c-card c-card--bordered l-spacing-md">
            <component-size>
              <width>100%</width>
              <padding>24px</padding>
              <background>#FFFFFF</background>
              <border-radius>8px</border-radius>
              <box-shadow>0 1px 3px rgba(0,0,0,0.1)</box-shadow>
              <margin-bottom:>24px</margin-bottom:>
            </component-size>
            <card-header class="l-spacing-sm">
              <component-size>
                <padding-bottom:>16px</padding-bottom:>
                <border-bottom:>1px solid var(--neutral-200)</border-bottom:>
                <margin-bottom:>16px</margin-bottom:>
              </component-size>
              <title class="text-display-s">Account Summary</title>
            </card-header>
            
            <card-content>
              <stats class="space-y-4">
                <component-size>
                  <gap:>16px between stat items</gap:>
                </component-size>
                <stat class="flex justify-between items-center">
                  <component-size>
                    <padding:>12px 0</padding:>
                  </component-size>
                  <label class="text-body-m">Total Orders</label>
                  <div class="text-right">
                    <value class="text-display-s">{orderCount}</value>
                    <link component="atoms/button" type="link" route="/orders" text="View Orders" size="sm"/>
                  </div>
                </stat>
                
                <stat class="flex justify-between items-center">
                  <label class="text-body-m">Wishlist Items</label>
                  <div class="text-right">
                    <value class="text-display-s">{wishlistCount}</value>
                    <link component="atoms/button" type="link" route="/wishlist" text="View Wishlist" size="sm"/>
                  </div>
                </stat>
                
                <stat class="flex justify-between items-center">
                  <label class="text-body-m">Account Status</label>
                  <value badge="active" component="atoms/badge">{user.status}</value>
                  <!-- {Active, Suspended, etc.} -->
                </stat>
              </stats>
            </card-content>
          </card>

          <!-- {Quick Actions Card} -->
          <card name="quick-actions">
            <card-header>
              <title>Quick Actions</title>
            </card-header>
            
            <card-content>
              <action-list>
                <action-item>
                  <link route="/orders" text="Order History"/>
                  <icon>orders-icon</icon>
                </action-item>
                
                <action-item>
                  <link route="/cart" text="Shopping Cart"/>
                  <icon>cart-icon</icon>
                </action-item>
                
                <action-item>
                  <link route="/updateProfile" text="Edit Profile"/>
                  <icon>edit-icon</icon>
                </action-item>
                
                <action-item>
                  <link route="/deleteaccount" text="Delete Account"/>
                  <icon>delete-icon</icon>
                  <warning>Destructive action</warning>
                </action-item>
              </action-list>
            </card-content>
          </card>

        </column>

      </section>

    </structure>

  </page>

  <!-- {Profile Edit Page} -->
  <page name="profile-edit" jsp-file="updateProfile.jsp">
    
    <metadata>
      <title>Edit Profile - IoTBay</title>
      <description>Update your account information</description>
      <route>/updateProfile</route>
      <template>t:base</template>
      <authentication>required</authentication>
    </metadata>

    <structure>
      
      <!-- {Page Header} -->
      <section name="page-header">
        <breadcrumb>
          <item name="Home" route="/"/>
          <item name="My Account" route="/profile"/>
          <item name="Edit Profile" active="true"/>
        </breadcrumb>
        <title>Edit Profile</title>
      </section>

      <!-- {Edit Form} -->
      <section name="edit-form" type="centered" class="l-container">
        <layout-structure>
          <design>Centered single-column layout for profile edit form</design>
          <container-width>max-width: 800px</container-width>
          <padding>32px responsive</padding>
        </layout-structure>
        
        <form-card class="c-card c-card--elevated">
          <component-size>
            <width>100%</width>
            <padding>40px</padding>
            <background>#FFFFFF</background>
            <border-radius>12px</border-radius>
            <box-shadow>0 4px 16px rgba(0,0,0,0.1)</box-shadow>
          </component-size>
          <!-- {Form card container} -->
          
          <!-- {Personal Information Section} -->
          <form-section name="personal-info" class="l-spacing-lg">
            <component-size>
              <padding-bottom:>32px</padding-bottom:>
              <border-bottom:>1px solid var(--neutral-200)</border-bottom:>
              <margin-bottom:>32px</margin-bottom:>
            </component-size>
            <title class="text-display-s l-spacing-md">Personal Information</title>
            
            <field-row class="flex gap-4">
              <component-size>
                <gap:>16px between fields</gap:>
              </component-size>
              <field-group name="firstName" component="molecules/form-field/form-field.jsp" class="flex-1">
                <component-size>
                  <width>50%</width>
                </component-size>
                <label>First Name</label>
                <input type="text" name="firstName" value="{user.firstName}" required="true">
                  <component-size>
                    <height>44px</height>
                    <padding:>12px 16px</padding:>
                  </component-size>
                </input>
              </field-group>
              
              <field-group name="lastName" component="molecules/form-field/form-field.jsp" class="flex-1">
                <component-size>
                  <width>50%</width>
                </component-size>
                <label>Last Name</label>
                <input type="text" name="lastName" value="{user.lastName}" required="true">
                  <component-size>
                    <height>44px</height>
                    <padding:>12px 16px</padding:>
                  </component-size>
                </input>
              </field-group>
            </field-row>
            
            <field-group name="email">
              <label>Email Address</label>
              <input type="email" name="email" value="{user.email}" required="true" readonly="true"/>
              <!-- {Email is read-only, requires separate change process} -->
              <help-text>To change your email, contact support</help-text>
            </field-group>
            
            <field-group name="phone">
              <label>Phone Number</label>
              <input type="tel" name="phone" value="{user.phone}" placeholder="(555) 123-4567"/>
            </field-group>
          </form-section>

          <!-- {Change Password Section} -->
          <form-section name="change-password">
            <title>Change Password</title>
            
            <field-group name="currentPassword">
              <label>Current Password</label>
              <input type="password" name="currentPassword" placeholder="Enter current password"/>
              <!-- {Required to change password} -->
            </field-group>
            
            <field-group name="newPassword">
              <label>New Password</label>
              <input type="password" name="newPassword" placeholder="Enter new password"/>
              <password-strength-meter/>
            </field-group>
            
            <field-group name="confirmPassword">
              <label>Confirm New Password</label>
              <input type="password" name="confirmPassword" placeholder="Re-enter new password"/>
            </field-group>
            
            <help-text>Leave blank if you don't want to change your password</help-text>
          </form-section>

          <!-- {Notification Preferences Section} -->
          <form-section name="notifications">
            <title>Notification Preferences</title>
            
            <field-group name="emailNotifications">
              <checkbox name="emailNotifications" checked="{user.emailNotifications}">
                <label>Receive email notifications</label>
              </checkbox>
            </field-group>
            
            <field-group name="newsletter">
              <checkbox name="newsletter" checked="{user.newsletter}">
                <label>Subscribe to newsletter</label>
              </checkbox>
            </field-group>
          </form-section>

          <!-- {Form Actions} -->
          <form-actions class="flex justify-end gap-3 l-spacing-lg">
            <component-size>
              <gap:>12px between buttons</gap:>
              <margin-top:>32px</margin-top:>
              <padding-top:>32px</padding-top:>
              <border-top:>1px solid var(--neutral-200)</border-top:>
            </component-size>
            <button component="atoms/button" type="secondary" route="/profile" text="Cancel">
              <component-size>
                <button-height:>44px</button-height:>
                <padding:>0 24px</padding:>
              </component-size>
            </button>
            <!-- {Cancel and return to profile view} -->
            <button component="atoms/button" type="primary" action="saveProfile" text="Save Changes">
              <component-size>
                <button-height:>44px</button-height:>
                <padding:>0 24px</padding:>
              </component-size>
            </button>
            <!-- {Save profile changes} -->
          </form-actions>
          
        </form-card>
        
      </section>

    </structure>

  </page>

  <!-- {Refactoring Context} -->
  <refactoring-context>
    <current-state>
      <issues>
        <issue>Profile edit form could have better validation feedback</issue>
        <issue>No email verification flow</issue>
        <issue>Address management could be more user-friendly</issue>
        <issue>No profile picture upload</issue>
        <issue>Password change requires current password but UI doesn't make this clear</issue>
      </issues>
    </current-state>
    <target-state>
      <improvements>
        <improvement>Add real-time form validation with inline feedback</improvement>
        <improvement>Implement email verification flow</improvement>
        <improvement>Add profile picture upload with image cropping</improvement>
        <improvement>Improve address management with inline editing</improvement>
        <improvement>Add two-factor authentication setup flow</improvement>
        <improvement>Implement account deletion with confirmation flow</improvement>
        <improvement>Add activity log/history section</improvement>
        <improvement>Mobile: Stack form sections vertically</improvement>
      </improvements>
    </target-state>
  </refactoring-context>

  <dependencies>
    <component name="header" file="components/header.jsp"/>
    <component name="footer" file="components/footer.jsp"/>
    <component name="profile-card" file="components/profile-card.jsp"/>
    <layout name="base" file="WEB-INF/tags/base.tag"/>
  </dependencies>

</pages>

